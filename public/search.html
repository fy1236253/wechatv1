<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<meta charset="utf-8" />
		<title>查快递</title>
		<link rel="stylesheet" type="text/css" href="css/weui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/Inquiry_my.css" />
		<script src="js/zepto.js" charset="UTF-8" type="text/javascript"></script>
		
	</head>

	<body>
		<div class="headDiv"></div>
		<div class="weui_cells weui_cells_form">
			<div class="weui_cell  weui_cell_select weui_cell_warn">
				<div class="weui_cell_bd weui_cell_primary" id="companySelect">
					
				</div>
			</div>
			<form action="/h5/search" method="get">
			<div class="weui_cell weui_cell_warn">
				<div class="weui_cell_bd weui_cell_primary">
					<input id="num" class="weui_input" name="num" type="text" placeholder="请输入快递单号" required>
				</div>

				<div class="weui_cell_hd" id="code" style=" width: 1.5em; height: 1.5em; background-image: url(img/icon@2x.png);background-repeat: no-repeat; background-position: center center;  background-size:80% auto ;">

				</div>
			</div>
		</div>
		<input type="hidden" value="{{.OpenId}}" id="openid" name="openid">

		<div class="bd">
			<input type="submit" href="javascript:;" value="查询" id="inquiry" class="weui_btn weui_btn_blue">
		</div>
		</form>
		<script src="js/Inquiry_my.js" charset="UTF-8" type="text/javascript"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
		<script type="text/javascript">
			//设置快递公司
			setCompany();

			//通过config接口注入权限验证配置
			wx.config({
				debug: false, 
				appId: '{{.AppId}}',
      			timestamp: {{.Ts}},
      			nonceStr: '{{.Nonce}}',
      			signature: '{{.Sign}}',
				jsApiList: ['scanQRCode'] // 必填，需要使用的JS接口列表
			});
			//通过ready接口处理成功验证
			wx.ready(function() {
				// config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后
				$('#code').tap(function() {
					//调用微信扫一扫接口
					wx.scanQRCode({
						needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
						scanType: ["barCode"], // 可以指定扫二维码还是一维码，默认二者都有
						success: function(res) {
							var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
							var index = result.indexOf(',');
							if (index != -1) {
								result = result.substr(index+1,result.length);
							}
							//设置为快递单号输入框的值
							var num = document.getElementById('num')
							num.value = result;
						}
					});					
				});
				//点击查询
				$('#inquiry').tap(function() {
					var company = document.querySelector('.weui_select').value;
					var num = document.getElementById('num').value;
					document.getElementById('num').value = $.trim(num)
					var openid = document.getElementById('openid').value;
					// $.getJSON('/h5/search?num='+num+"&openid="+openid, function (stat) {
					// 	if (stat=="success") {
					// 		alert("success")
					// 	}
					// });
					// 	if (num.length > 0) {
					// 		var str = "http://m.kuaidi100.com/index_all.html?" + "postid=" + num;
							
					// 		window.location.href = str;
					// 	}else{
					// 		alert('快递单号不能为空')
					// 	}
					// } else {
					// 	if (num.length > 0) {
					// 		var str = "http://m.kuaidi100.com/index_all.html?type=" + company + "&postid=" + num;
							
					// 		window.location.href = str;
					// 	}else{
					// 		alert('快递单号不能为空')
					// 	}
					// }

				
				//选择快递公司监听
				var companySelect = document.querySelector('.weui_select');
				companySelect.onchange = function() {
					if (companySelect.value == '选择快递公司(可不选择)') {
						companySelect.style.color = 'lightgray'
					} else {
						companySelect.style.color = 'black'
					}
				}
			});
		});
		</script>
	</body>

</html>